<div class="dashboard-container">
  
  <!-- Header Section -->
  <header class="dashboard-header">
    <div class="header-content">
      <div class="greeting-section">
        <span class="greeting-text">{{ greeting() }}</span>
        <h1 class="date-text">{{ todayLabel }}</h1>
      </div>
      
      <div class="actions-section">
        <button mat-stroked-button class="action-btn secondary" routerLink="/salary">
          <mat-icon>account_balance</mat-icon>
          <span>الراتب</span>
        </button>
        <button mat-flat-button class="action-btn primary" routerLink="/expense">
          <mat-icon>add</mat-icon>
          <span>جديد</span>
        </button>
      </div>
    </div>

    <!-- Main Balance Card -->
    <div class="balance-overview" [class.negative]="totalBalance() < 0">
      <div class="balance-label">الرصيد المتاح</div>
      <div class="balance-amount">
        {{ totalBalance() | number:'1.0-2' }}
        <span class="currency">ج.م</span>
      </div>
      <div class="balance-trend">
        <mat-icon>{{ totalBalance() >= 0 ? 'trending_up' : 'trending_down' }}</mat-icon>
        <span>{{ totalBalance() >= 0 ? 'وضع مالي جيد' : 'تجاوزت الرصيد' }}</span>
      </div>
    </div>
  </header>

  <!-- Quick Stats Grid -->
  <section class="stats-row">
    <!-- Daily Limit Card -->
    <div class="stat-card" [class.warning]="progressKind() === 'warning'" [class.danger]="progressKind() === 'danger'">
      <div class="stat-icon-wrapper daily">
        <mat-icon>today</mat-icon>
      </div>
      <div class="stat-content">
        <span class="stat-label">المتبقي اليوم</span>
        <div class="stat-values">
          <span class="current-value">{{ remaining() | number:'1.0-0' }}</span>
          <span class="limit-value"> / {{ dailyLimit() | number:'1.0-0' }}</span>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" [style.width.%]="dailyProgressPercent()"></div>
        </div>
      </div>
    </div>

    <!-- Weekly Limit Card -->
    <div class="stat-card" [class.warning]="weeklyProgressKind() === 'warning'" [class.danger]="weeklyProgressKind() === 'danger'">
      <div class="stat-icon-wrapper weekly">
        <mat-icon>date_range</mat-icon>
      </div>
      <div class="stat-content">
        <span class="stat-label">المتبقي أسبوعياً</span>
        <div class="stat-values">
          <span class="current-value">{{ weeklyRemaining() | number:'1.0-0' }}</span>
          <span class="limit-value"> / {{ weeklyLimit() | number:'1.0-0' }}</span>
        </div>
        <div class="progress-bar-container">
          <div class="progress-bar" [style.width.%]="weeklyProgressPercent()"></div>
        </div>
      </div>
    </div>

    <!-- Monthly Summary -->
    <div class="stat-card info">
      <div class="stat-icon-wrapper monthly">
        <mat-icon>pie_chart</mat-icon>
      </div>
      <div class="stat-content">
        <span class="stat-label">مصروفات الشهر</span>
        <div class="stat-values">
          <span class="current-value">{{ totalExpenses() | number:'1.0-0' }}</span>
          <span class="sub-value">من {{ totalSalary() | number:'1.0-0' }}</span>
        </div>
        <div class="mini-status">
          {{ currentMonthSalary() > 0 ? ((totalExpenses() / currentMonthSalary()) * 100 | number:'1.0-0') : 0 }}% من الدخل
        </div>
      </div>
    </div>
  </section>

  <div class="main-grid">
    <!-- Activity Feed / Today's Expenses -->
    <section class="activity-section">
      <div class="section-header">
        <h2>مصروفات اليوم</h2>
        <span class="total-badge">{{ todayTotal() | number:'1.0-0' }} ج.م</span>
      </div>

      <div class="transactions-list" *ngIf="todayExpenses().length > 0; else emptyState">
        <div class="transaction-card" *ngFor="let expense of todayExpenses()">
          <div class="trans-icon category-icon">
            <mat-icon>shopping_bag</mat-icon>
          </div>
          <div class="trans-info">
            <div class="trans-category">{{ expense.category }}</div>
            <div class="trans-time">{{ expense.date | date:'shortTime' }}</div> <!-- Assuming date implies time or just showing date -->
          </div>
          <div class="trans-amount">
            -{{ expense.amount | number:'1.0-0' }}
          </div>
          <button mat-icon-button color="warn" class="delete-btn" (click)="deleteExpense(expense.id)">
            <mat-icon>close</mat-icon>
          </button>
        </div>
      </div>

      <ng-template #emptyState>
        <div class="empty-state">
          <div class="empty-icon">
            <mat-icon>savings</mat-icon>
          </div>
          <h3>لا توجد مصروفات اليوم</h3>
          <p>بداية جيدة! لم تقم بصرف أي شيء اليوم.</p>
          <button mat-button color="primary" routerLink="/add-expense">تسجيل مصروف</button>
        </div>
      </ng-template>
    </section>

    <!-- Insights / Tips Panel -->
    <aside class="insights-section">
      <div class="insight-card">
        <div class="card-header">
          <mat-icon>lightbulb</mat-icon>
          <h3>نظرة سريعة</h3>
        </div>
        <div class="insight-content">
          <div class="insight-row" [class.good]="progress() < 0.5" [class.bad]="progress() > 0.8">
            <span class="label">استهلاك اليوم:</span>
            <span class="value">{{ dailyProgressPercent() }}%</span>
          </div>
           <div class="insight-row" [class.good]="weeklyProgress() < 0.5" [class.bad]="weeklyProgress() > 0.8">
            <span class="label">استهلاك الأسبوع:</span>
            <span class="value">{{ weeklyProgressPercent() }}%</span>
          </div>
          <p class="insight-tip" *ngIf="progress() < 0.5">أداء ممتاز! أنت تقتصد بشكل جيد اليوم.</p>
          <p class="insight-tip warning" *ngIf="progress() >= 0.5 && progress() <= 0.9">انتبه، لقد استهلكت أكثر من نصف ميزانيتك اليومية.</p>
          <p class="insight-tip danger" *ngIf="progress() > 0.9">تحذير: أوشكت على تجاوز الحد اليومي!</p>
        </div>
      </div>
    </aside>
  </div>
</div>