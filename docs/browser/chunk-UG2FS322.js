import{J as l,N as s,Qb as c,Rb as u,Y as n}from"./chunk-IKTNIUHG.js";var r={dailyLimit:0,weeklyLimit:0,currency:"\u062C.\u0645",updatedAt:new Date().toISOString()},y=class a{supabase=s(c);auth=s(u);loading=n(!1);settings=n({id:"",dailyLimit:r.dailyLimit,weeklyLimit:r.weeklyLimit,currency:r.currency,updatedAt:new Date().toISOString()});async load(){this.loading.set(!0);try{let e=this.auth.currentUser()?.id;if(!e)return;let{data:t,error:i}=await this.supabase.client.from("user_settings").select("*").eq("user_id",e).single();i&&i.code==="PGRST116"?await this.createDefault(e):t&&this.settings.set({id:t.id,dailyLimit:t.daily_limit,weeklyLimit:t.weekly_limit,currency:t.currency,updatedAt:t.updated_at})}finally{this.loading.set(!1)}}async createDefault(e){let{data:t,error:i}=await this.supabase.client.from("user_settings").insert({user_id:e,daily_limit:r.dailyLimit,weekly_limit:r.weeklyLimit,currency:r.currency}).select().single();t&&this.settings.set({id:t.id,dailyLimit:t.daily_limit,weeklyLimit:t.weekly_limit,currency:t.currency,updatedAt:t.updated_at})}async update(e){let t=this.auth.currentUser()?.id;if(!t)throw new Error("User not authenticated");let{data:i,error:d}=await this.supabase.client.from("user_settings").update({daily_limit:e.dailyLimit,weekly_limit:e.weeklyLimit,currency:e.currency}).eq("user_id",t).select().single();if(d)throw d;return i&&this.settings.set({id:i.id,dailyLimit:i.daily_limit,weeklyLimit:i.weekly_limit,currency:i.currency,updatedAt:i.updated_at}),this.settings()}static \u0275fac=function(t){return new(t||a)};static \u0275prov=l({token:a,factory:a.\u0275fac,providedIn:"root"})};export{y as a};
