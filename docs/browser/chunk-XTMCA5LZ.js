import{d as m}from"./chunk-EV7PFGVU.js";import{J as d,N as i,Qb as h,Rb as c,Y as l,mb as s}from"./chunk-IKTNIUHG.js";var y=class o{supabase=i(h);auth=i(c);loading=l(!1);salaries=l([]);totalSalary=s(()=>this.salaries().reduce((e,t)=>e+t.amount,0));salariesByMonth=s(()=>{let e=new Map;for(let t of this.salaries()){let r=e.get(t.month)||[];r.push(t),e.set(t.month,r)}return Array.from(e.entries()).map(([t,r])=>({month:t,salaries:r,total:r.reduce((a,n)=>a+n.amount,0)})).sort((t,r)=>r.month.localeCompare(t.month))});async refresh(){this.loading.set(!0);try{let e=this.auth.currentUser()?.id;if(!e){this.salaries.set([]);return}let{data:t,error:r}=await this.supabase.client.from("salaries").select("*").eq("user_id",e).order("month",{ascending:!1});if(r)throw r;this.salaries.set(t||[])}finally{this.loading.set(!1)}}async add(e){let t=this.auth.currentUser()?.id;if(!t)throw new Error("User not authenticated");let r=new Date,a={id:crypto.randomUUID(),amount:e.amount,month:e.month,notes:e.notes,createdAt:r.toISOString(),updatedAt:r.toISOString()},{data:n,error:u}=await this.supabase.client.from("salaries").insert({user_id:t,amount:a.amount,month:a.month,notes:a.notes}).select().single();if(u)throw u;return await this.refresh(),n}async update(e){let t=this.auth.currentUser()?.id;if(!t)throw new Error("User not authenticated");let{data:r,error:a}=await this.supabase.client.from("salaries").update({amount:e.amount,month:e.month,notes:e.notes}).eq("id",e.id).eq("user_id",t).select().single();if(a)throw a;return await this.refresh(),r}async remove(e){let t=this.auth.currentUser()?.id;if(!t)throw new Error("User not authenticated");let{error:r}=await this.supabase.client.from("salaries").delete().eq("id",e).eq("user_id",t);if(r)throw r;await this.refresh()}async getById(e){let{data:t,error:r}=await this.supabase.client.from("salaries").select("*").eq("id",e).single();if(r)throw r;return t}getSalaryByMonth(e){return s(()=>this.salaries().filter(t=>t.month===e))}getTotalByMonth(e){return s(()=>this.getSalaryByMonth(e)().reduce((t,r)=>t+r.amount,0))}getCurrentMonth(){return m(new Date,"yyyy-MM")}getAllMonths(){return s(()=>{let e=new Set(this.salaries().map(t=>t.month));return Array.from(e).sort((t,r)=>r.localeCompare(t))})}static \u0275fac=function(t){return new(t||o)};static \u0275prov=d({token:o,factory:o.\u0275fac,providedIn:"root"})};export{y as a};
